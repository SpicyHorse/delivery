{% extends "layout.html" %}

{% block title %}Slash{% endblock %}

{% block style %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/jquery-jvectormap.css') }}" />
{% endblock %}

{% block script %}
<script src="{{ url_for('static', filename='js/jquery-jvectormap.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery-jvectormap-world-en.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.flot.js') }}"></script>
<script>
var cntryStats = {{cnt_stats_p|tojson|safe}};
var dlStats = {{dl_cnt_p|tojson|safe}};
var tzOfset = (new Date()).getTimezoneOffset() * 60;
for (var i = dlStats.length - 1; i >= 0; i--){
	for (var e = dlStats[i].length - 1; e >= 0; e--){
		dlStats[i][e][0]=(dlStats[i][e][0]-tzOfset) * 1000;
	};
};
$(function(){
	$('#map').vectorMap({
		map: 'world_en',
		series: {
			regions: [{
				values: cntryStats,
				scale: ['#C8EEFF', '#0071A4'],
				normalizeFunction: 'polynomial'
			}]
		},
		onRegionLabelShow: function(e, el, code){
			el.html(el.html()+' (Downloads: '+cntryStats[code]+')');
		}
	});
	plot = $.plot( $("#graph"),
	[
		{ data: dlStats[0], label: "Downloads"},
		{ data: dlStats[1], label: "Seeds"},
		{ data: dlStats[2], label: "Peers"}
	], {
		series: {
				lines: { show: true },
				points: { show: true }
		},
		grid: { hoverable: true, autoHighlight: false },
		xaxis: {
			mode: "time",
			timeformat: "%H:%M\<br\>%m/%d"
		}
	});
})
</script>
{% endblock %}
	
{% block content %}
<div class="page-header">
    <h1>Global statistics (last 24h)</h1>
</div>

<div class="row">
	<div id="map" class="span12" style="height:460px;"></div>
</div>

<div class="page-header">
	<h2>Download history</h2>
</div>

<div class="row">
	<div id="graph" class="span12" style="height:200px;"></div>
</div>

<div class="page-header">
	<h2>Top countries</h2>
</div>

<div class="row">
	<div class="span12">
		<table class="table table-striped table-bordered table-condensed">
			<thead>
				<tr>
					<th style="width:20px;">#</th>
					<th style="width:80px;">Country</th>
					<th>Count</th>
				</tr>
			</thead>
			<tbody>
				{% for r in cnt_stats%}
				<tr>
					<td>{{ loop.index }}</td>
					<td>{% if r[0] %}{{ r[0] }}{% else %} Unknown {% endif %}</td>
					<td>{{ r[1] }}</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
</div>

{% endblock %}
